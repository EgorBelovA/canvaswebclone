version: '3.8'
# x-environment-defaults: &environment-defaults
#   DEBUG: 'False'
#   DB_NAME: 'canvas'
#   DB_USER: 'canvas'
#   DB_PASSWORD: 'canvas'
#   DB_HOST: 'postgres-db'
#   DB_PORT: 5432
#   CELERY_BROKER_URL: 'redis://redis:6379/0'
#   CELERY_RESULT_BACKEND: 'redis://redis:6379/0'
#   SECRET_KEY: 'secret'

services:
  postgres-db:
    image: postgres:latest
    container_name: postgres
    environment:
      POSTGRES_DB: canvas
      POSTGRES_USER: canvas
      POSTGRES_PASSWORD: canvas
    ports:
      - '5432:5432'

  # volumes:
  #   - pg_data:/var/lib/postgresql/data
  # networks:
  #   - canvas-network

  canvas:
    build:
      context: ./
    ports:
      - '8000:8000'
    restart: always
    depends_on:
      - postgres-db
      - redis
    environment:
      DEBUG: 'False'
      DB_NAME: 'canvas'
      DB_USER: 'canvas'
      DB_PASSWORD: 'canvas'
      DB_HOST: 'postgres'
      DB_PORT: 5432
      SECRET_KEY: 'secret'
    volumes:
      - static_volume:/app/static

  redis:
    image: redis:latest
    ports:
      - '6379:6379'

  nginx:
    image: nginx:latest
    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf
      - static_volume:/static
    ports:
      - '80:80'

    depends_on:
      - canvas

  # canvas-app:
  #   build:
  #     context: ./frontend
  #   restart: always
  #   ports:
  #     - '3000:3000'

  # networks:
  #   - canvas-network
  # channels:
  #   build: ./
  #   command:
  #   ports:
  #     - '8001:8001'
  #   links:
  #     - redis

volumes:
  static_volume:
# networks:
#   canvas-network:
#     driver: bridge
